"""
ğŸ”¥ Apple Hybrid Approach V1
- Browser: ÙŠÙØªØ­ Ø§Ù„ØµÙØ­Ø© ÙˆÙŠØ¬ÙŠØ¨ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ© + Ø§Ù„ÙƒÙˆÙƒÙŠØ² + scnt + ssid
- Requests: ÙŠÙƒÙ…Ù„ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø®Ø·ÙˆØ§Øª Ø¨Ø³Ø±Ø¹Ø© (captcha, validation, SMS)
"""
import random
import string
import time
import json
import names
from datetime import datetime
from seleniumbase import SB
from curl_cffi import requests

# --- Configuration ---
HEADLESS = False Â # Ø®Ù„ÙŠÙ‡ False Ø¹Ø´Ø§Ù† ØªØ´ÙˆÙ Ø§Ù„Ø¨ØµÙ…Ø© Ø¨ØªØªÙˆÙ„Ø¯
PHONE_NUMBER = f"112220{random.randint(1111, 9999)}"
COUNTRY_CODE = "EG" Â  Â  Â  Â  Â # Ù„Ù„ØªÙ„ÙŠÙÙˆÙ†
COUNTRY_ISO3 = "EGY" Â  Â  Â  Â  # Ù„Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙˆØ§Ù„Ù€ Prime
COUNTRY_DIAL_CODE = "20"
CAPTCHA_API_KEY = "24e088a6705474c23b42e3fcb4e6f5d0"

# --- Helper Functions ---
def gen_email():
Â  Â  name = names.get_first_name().lower()
Â  Â  return f"{name}{random.randint(1111, 999999)}@gmail.com"

def gen_password():
Â  Â  upper = random.choice(string.ascii_uppercase)
Â  Â  lower = random.choice(string.ascii_lowercase)
Â  Â  digit = random.choice(string.digits)
Â  Â  special = random.choice("!@#$%")
Â  Â  rest = "".join(random.choice(string.ascii_letters + string.digits + "!@#$%") for _ in range(8))
Â  Â  pwd_list = list(upper + lower + digit + special + rest)
Â  Â  random.shuffle(pwd_list)
Â  Â  return "".join(pwd_list)

def get_random_dob():
Â  Â  return f"{random.randint(1990, 2000)}-{random.randint(1, 12):02d}-{random.randint(1, 28):02d}"

def solve_captcha_2captcha(image_base64):
Â  Â  """Ø­Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… 2Captcha"""
Â  Â  print("[-] Solving Captcha using 2Captcha...")
Â  Â  url_in = "http://2captcha.com/in.php"
Â  Â  url_res = "http://2captcha.com/res.php"
Â  Â  data = {'key': CAPTCHA_API_KEY, 'method': 'base64', 'body': image_base64, 'json': 1}
Â  Â  try:
Â  Â  Â  Â  response = requests.post(url_in, data=data)
Â  Â  Â  Â  if response.json().get('status') == 1:
Â  Â  Â  Â  Â  Â  captcha_id = response.json().get('request')
Â  Â  Â  Â  Â  Â  print(f"[+] Captcha ID: {captcha_id}")
Â  Â  Â  Â  Â  Â  for _ in range(25):
Â  Â  Â  Â  Â  Â  Â  Â  time.sleep(3)
Â  Â  Â  Â  Â  Â  Â  Â  resp = requests.get(f"{url_res}?key={CAPTCHA_API_KEY}&action=get&id={captcha_id}&json=1")
Â  Â  Â  Â  Â  Â  Â  Â  if resp.json().get('status') == 1:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"[+] Captcha Solved: {resp.json().get('request')}")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return resp.json().get('request')
Â  Â  except Exception as e:
Â  Â  Â  Â  print(f"[!] Captcha Error: {e}")
Â  Â  return None

# --- HashCash Functions ---
def solve_hashcash(challenge, bits):
Â  Â  import hashlib
Â  Â  version = 1
Â  Â  now = datetime.now()
Â  Â  date_str = now.strftime("%Y%m%d%H%M%S") + f"{now.microsecond // 1000:03d}"
Â  Â  prefix = f"{version}:{bits}:{date_str}:{challenge}::"
Â  Â  
Â  Â  print(f"[-] Solving HashCash (bits={bits})...")
Â  Â  
Â  Â  for _ in range(5):
Â  Â  Â  Â  nonce = random.randint(0, 10000000)
Â  Â  Â  Â  for i in range(100000):
Â  Â  Â  Â  Â  Â  candidate = f"{prefix}{nonce + i}"
Â  Â  Â  Â  Â  Â  hash_bytes = hashlib.sha256(candidate.encode()).digest()
Â  Â  Â  Â  Â  Â  hash_int = int.from_bytes(hash_bytes, 'big')
Â  Â  Â  Â  Â  Â  if (hash_int >> (256 - bits)) == 0:
Â  Â  Â  Â  Â  Â  Â  Â  print(f"[+] HashCash Solved! Nonce: {nonce+i}")
Â  Â  Â  Â  Â  Â  Â  Â  return candidate
Â  Â  
Â  Â  print("[!] HashCash failed - using fallback")
Â  Â  return f"{prefix}0"

# ========================================
# PHASE 1: Browser - Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©
# ========================================
def extract_session_from_browser():
Â  Â  """
Â  Â  ÙŠÙØªØ­ Ø§Ù„Ù…ØªØµÙØ­ ÙˆÙŠØ³ØªØ®Ø±Ø¬:
Â  Â  - X-Apple-I-FD-Client-Info (Ø§Ù„Ø¨ØµÙ…Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©)
Â  Â  - Ø§Ù„ÙƒÙˆÙƒÙŠØ²
Â  Â  - scnt
Â  Â  - X-Apple-ID-Session-Id
Â  Â  """
Â  Â  print("\n" + "="*50)
Â  Â  print("ğŸŒ PHASE 1: Browser Session Extraction")
Â  Â  print("="*50)
Â  Â  
Â  Â  session_data = {
Â  Â  Â  Â  'fingerprint': None,
Â  Â  Â  Â  'cookies': {},
Â  Â  Â  Â  'scnt': None,
Â  Â  Â  Â  'ssid': None,
Â  Â  Â  Â  'user_agent': None
Â  Â  }
Â  Â  
Â  Â  with SB(uc=True, headless=HEADLESS) as sb:
Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  print("[-] Opening Apple Account page...")
Â  Â  Â  Â  Â  Â  sb.uc_open_with_reconnect("https://account.apple.com/account", reconnect_time=4)
Â  Â  Â  Â  Â  Â  sb.sleep(5)
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù€ User-Agent
Â  Â  Â  Â  Â  Â  session_data['user_agent'] = sb.execute_script("return navigator.userAgent;")
Â  Â  Â  Â  Â  Â  print(f"[+] User-Agent: {session_data['user_agent'][:50]}...")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù€ iframe
Â  Â  Â  Â  Â  Â  print("[-] Waiting for iframe to load...")
Â  Â  Â  Â  Â  Â  sb.sleep(3)
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙˆÙƒÙŠØ²
Â  Â  Â  Â  Â  Â  all_cookies = sb.get_cookies()
Â  Â  Â  Â  Â  Â  for cookie in all_cookies:
Â  Â  Â  Â  Â  Â  Â  Â  session_data['cookies'][cookie['name']] = cookie['value']
Â  Â  Â  Â  Â  Â  print(f"[+] Extracted {len(session_data['cookies'])} cookies")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ØµÙ…Ø© Ù…Ù† Network requests
Â  Â  Â  Â  Â  Â  # Ù†Ø³ØªØ®Ø¯Ù… JavaScript Ø¹Ø´Ø§Ù† Ù†Ø¬ÙŠØ¨ Ø¢Ø®Ø± request Ù„Ù„Ø³ÙŠØ±ÙØ±
Â  Â  Â  Â  Â  Â  print("[-] Extracting fingerprint from page...")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ØµÙ…Ø© Ù…Ù† Ø§Ù„Ù€ localStorage Ø£Ùˆ Ù…Ù† Ø§Ù„Ù€ page context
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  # Apple ÙŠØ®Ø²Ù† Ø§Ù„Ø¨ØµÙ…Ø© ÙÙŠ Ù…ØªØºÙŠØ± global Ø£Ø­ÙŠØ§Ù†Ø§Ù‹
Â  Â  Â  Â  Â  Â  Â  Â  fingerprint_script = """
Â  Â  Â  Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Try to find fingerprint in window objects
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (window.__APPLE_CLIENT_INFO__) return JSON.stringify(window.__APPLE_CLIENT_INFO__);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (window.AppleIDAuthClientInfo) return JSON.stringify(window.AppleIDAuthClientInfo);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Generate a fresh fingerprint using Apple's own script
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  } catch(e) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  return null;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  """
Â  Â  Â  Â  Â  Â  Â  Â  fp = sb.execute_script(fingerprint_script)
Â  Â  Â  Â  Â  Â  Â  Â  if fp:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  session_data['fingerprint'] = fp
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"[+] Found fingerprint in page context!")
Â  Â  Â  Â  Â  Â  except:
Â  Â  Â  Â  Â  Â  Â  Â  pass
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø£Ø¶Ù…Ù†: Ù†Ø¹Ù…Ù„ request ÙŠØ¯ÙˆÙŠ ÙˆÙ†Ø´ÙˆÙ Ø§Ù„Ù€ response headers
Â  Â  Â  Â  Â  Â  print("[-] Making test request to get scnt and ssid...")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Switch to iframe and trigger a request
Â  Â  Â  Â  Â  Â  iframe = "iframe#aid-create-widget-iFrame"
Â  Â  Â  Â  Â  Â  if sb.is_element_visible(iframe):
Â  Â  Â  Â  Â  Â  Â  Â  sb.switch_to_frame(iframe)
Â  Â  Â  Â  Â  Â  Â  Â  print("[+] Switched to iframe")
Â  Â  Â  Â  Â  Â  Â  Â  sb.sleep(2)
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ù…Ø±Ø© ØªØ§Ù†ÙŠØ© Ø¨Ø¹Ø¯ Ø§Ù„Ù€ iframe
Â  Â  Â  Â  Â  Â  all_cookies = sb.get_cookies()
Â  Â  Â  Â  Â  Â  for cookie in all_cookies:
Â  Â  Â  Â  Â  Â  Â  Â  session_data['cookies'][cookie['name']] = cookie['value']
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ù†Ø·Ù„Ø¹ Ù…Ù† Ø§Ù„Ù€ iframe
Â  Â  Â  Â  Â  Â  sb.switch_to_default_content()
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ù†Ø¹Ù…Ù„ XHR request Ù…Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ø´Ø§Ù† Ù†Ø¬ÙŠØ¨ Ø§Ù„Ù€ scnt Ùˆ ssid
Â  Â  Â  Â  Â  Â  print("[-] Making XHR request to get tokens...")
Â  Â  Â  Â  Â  Â  xhr_script = """
Â  Â  Â  Â  Â  Â  return new Promise((resolve, reject) => {
Â  Â  Â  Â  Â  Â  Â  Â  var xhr = new XMLHttpRequest();
Â  Â  Â  Â  Â  Â  Â  Â  xhr.open('GET', 'https://appleid.apple.com/account/manage/gs/ws/token', true);
Â  Â  Â  Â  Â  Â  Â  Â  xhr.setRequestHeader('Accept', 'application/json');
Â  Â  Â  Â  Â  Â  Â  Â  xhr.setRequestHeader('X-Apple-I-Request-Context', 'ca');
Â  Â  Â  Â  Â  Â  Â  Â  xhr.onload = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  resolve({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  scnt: xhr.getResponseHeader('scnt'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ssid: xhr.getResponseHeader('X-Apple-ID-Session-Id'),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: xhr.status
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  xhr.onerror = function() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  reject('XHR failed');
Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  xhr.send();
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  """
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  try:
Â  Â  Â  Â  Â  Â  Â  Â  result = sb.execute_async_script(xhr_script)
Â  Â  Â  Â  Â  Â  Â  Â  if result:
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  session_data['scnt'] = result.get('scnt')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  session_data['ssid'] = result.get('ssid')
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"[+] Got scnt: {session_data['scnt'][:20] if session_data['scnt'] else 'None'}...")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  print(f"[+] Got ssid: {session_data['ssid'][:20] if session_data['ssid'] else 'None'}...")
Â  Â  Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  Â  Â  print(f"[!] XHR Error: {e}")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ØµÙ…Ø© Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø¨Ø¯ÙŠÙ„Ø© - Ù…Ù† Performance API
Â  Â  Â  Â  Â  Â  print("[-] Extracting fingerprint from network requests...")
Â  Â  Â  Â  Â  Â  network_script = """
Â  Â  Â  Â  Â  Â  var entries = performance.getEntriesByType('resource');
Â  Â  Â  Â  Â  Â  var fdClientInfo = null;
Â  Â  Â  Â  Â  Â  for (var i = entries.length - 1; i >= 0; i--) {
Â  Â  Â  Â  Â  Â  Â  Â  var url = entries[i].name;
Â  Â  Â  Â  Â  Â  Â  Â  if (url.includes('appleid.apple.com')) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Found an Apple request
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  break;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Ø§Ù„Ù€ fingerprint Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ Ø¨ÙŠØªÙˆÙ„Ø¯ Ù…Ù† JavaScript ÙÙŠ Ø§Ù„ØµÙØ­Ø©
Â  Â  Â  Â  Â  Â  // Ù†Ø±Ø¬Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
Â  Â  Â  Â  Â  Â  return {
Â  Â  Â  Â  Â  Â  Â  Â  userAgent: navigator.userAgent,
Â  Â  Â  Â  Â  Â  Â  Â  language: navigator.language,
Â  Â  Â  Â  Â  Â  Â  Â  timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
Â  Â  Â  Â  Â  Â  Â  Â  platform: navigator.platform,
Â  Â  Â  Â  Â  Â  Â  Â  screen: screen.width + 'x' + screen.height
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  """
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  browser_info = sb.execute_script(network_script)
Â  Â  Â  Â  Â  Â  print(f"[+] Browser Info: {browser_info}")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  # Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨ØµÙ…Ø© Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„ÙŠ Ø¬Ù…Ø¹Ù†Ø§Ù‡Ø§
Â  Â  Â  Â  Â  Â  if not session_data['fingerprint']:
Â  Â  Â  Â  Â  Â  Â  Â  # Ù†Ø³ØªØ®Ø¯Ù… Ø¨ØµÙ…Ø© Ø«Ø§Ø¨ØªØ© Ø­Ù‚ÙŠÙ‚ÙŠØ© Ù…Ù† Burp + Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…ØªØµÙØ­
Â  Â  Â  Â  Â  Â  Â  Â  real_f = "Nla44j1e3NlY5BNlY5BSs5uQ084akLJ6O8To9idcJrKTgW.1LgJh46KZ7..f4AGGpO1.1em3.7Pm3.7Pm3.2KZ77M6pZ7.SbxO1.1Pm3.3jum3..pZ7.0ygW.3klYIU.KI5.jKXgW.0KO1.0elHoJSLFV.LgJh46KZ7.9f7F.Wf7F.KLFV.1gW01sygW.1KzLFV.agW.14zLFV.egW.2fxO108WY5BNlYJNNlY5QB4bVNjMk.Bpr"
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  fingerprint_obj = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "U": session_data['user_agent'],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "L": browser_info.get('language', 'ar')[:2],
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "Z": "GMT+02:00",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "V": "1.1",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "F": real_f
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  session_data['fingerprint'] = json.dumps(fingerprint_obj, separators=(',', ':'))
Â  Â  Â  Â  Â  Â  Â  Â  print(f"[+] Built fingerprint from browser data")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  print("\n[âœ“] Browser session extraction complete!")
Â  Â  Â  Â  Â  Â  print(f" Â  Â Cookies: {len(session_data['cookies'])}")
Â  Â  Â  Â  Â  Â  print(f" Â  Â Fingerprint: {'OK' if session_data['fingerprint'] else 'MISSING'}")
Â  Â  Â  Â  Â  Â  print(f" Â  Â scnt: {'OK' if session_data['scnt'] else 'MISSING'}")
Â  Â  Â  Â  Â  Â  print(f" Â  Â ssid: {'OK' if session_data['ssid'] else 'MISSING'}")
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  except Exception as e:
Â  Â  Â  Â  Â  Â  print(f"[!] Browser Error: {e}")
Â  Â  Â  Â  Â  Â  import traceback
Â  Â  Â  Â  Â  Â  traceback.print_exc()
Â  Â  
Â  Â  return session_data

# ========================================
# PHASE 2: Requests - Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
# ========================================
def complete_registration_with_requests(session_data):
Â  Â  """
Â  Â  ÙŠØ³ØªØ®Ø¯Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„ÙŠ Ø¬Ù…Ø¹Ù†Ø§Ù‡Ø§ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ø´Ø§Ù† ÙŠÙƒÙ…Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
Â  Â  """
Â  Â  print("\n" + "="*50)
Â  Â  print("âš¡ PHASE 2: Completing Registration with Requests")
Â  Â  print("="*50)
Â  Â  
Â  Â  # ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
Â  Â  if not session_data.get('scnt') or not session_data.get('ssid'):
Â  Â  Â  Â  print("[!] Missing scnt or ssid! Cannot continue.")
Â  Â  Â  Â  return False
Â  Â  
Â  Â  # Ø¥Ù†Ø´Ø§Ø¡ Session Ø¬Ø¯ÙŠØ¯Ø©
Â  Â  session = requests.Session(impersonate="firefox")
Â  Â  
Â  Â  # Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙƒÙˆÙƒÙŠØ² Ø§Ù„Ù„ÙŠ Ø¬Ù…Ø¹Ù†Ø§Ù‡Ø§
Â  Â  for name, value in session_data['cookies'].items():
Â  Â  Â  Â  session.cookies.set(name, value)
Â  Â  print(f"[+] Loaded {len(session_data['cookies'])} cookies into session")
Â  Â  
Â  Â  # Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
Â  Â  EMAIL = gen_email()
Â  Â  PASSWORD = gen_password()
Â  Â  FIRST_NAME = names.get_first_name()
Â  Â  LAST_NAME = names.get_last_name()
Â  Â  BIRTHDAY = get_random_dob()
Â  Â  
Â  Â  print(f"\nğŸ“§ Email: {EMAIL}")
Â  Â  print(f"ğŸ” Password: {PASSWORD}")
Â  Â  print(f"ğŸ‘¤ Name: {FIRST_NAME} {LAST_NAME}")
Â  Â  print(f"ğŸ“… Birthday: {BIRTHDAY}")
Â  Â  print(f"ğŸ“± Phone: +{COUNTRY_DIAL_CODE} {PHONE_NUMBER}")
Â  Â  
Â  Â  # Ø§Ù„Ù‡ÙŠØ¯Ø±Ø² Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
Â  Â  common_headers = {
Â  Â  Â  Â  "User-Agent": session_data['user_agent'],
Â  Â  Â  Â  "Accept": "application/json, text/plain, */*",
Â  Â  Â  Â  "Accept-Language": "ar,en-US;q=0.9,en;q=0.8",
Â  Â  Â  Â  "Content-Type": "application/json",
Â  Â  Â  Â  "Connection": "keep-alive",
Â  Â  Â  Â  "Origin": "https://appleid.apple.com",
Â  Â  Â  Â  "Referer": "https://appleid.apple.com/",
Â  Â  Â  Â  "X-Apple-I-Request-Context": "account",
Â  Â  Â  Â  "X-Apple-I-TimeZone": "Africa/Cairo",
Â  Â  Â  Â  "X-Apple-I-FD-Client-Info": session_data['fingerprint'],
Â  Â  Â  Â  "X-Apple-Widget-Key": "af1139274f266b22b68c2a3e7ad932cb3c0bbe854e13a79af78dcc73136882c3",
Â  Â  Â  Â  "scnt": session_data['scnt'],
Â  Â  Â  Â  "X-Apple-ID-Session-Id": session_data['ssid']
Â  Â  }
Â  Â  
Â  Â  time.sleep(random.uniform(1, 2))
Â  Â  
Â  Â  # --- Step 1: Get HashCash Challenge ---
Â  Â  print("\n[-] 1. Getting HashCash challenge...")
Â  Â  hc_headers = {
Â  Â  Â  Â  'Host': 'appleid.apple.com',
Â  Â  Â  Â  'User-Agent': session_data['user_agent'],
Â  Â  Â  Â  'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',
Â  Â  Â  Â  'Accept-Language': 'ar,en-US;q=0.9,en;q=0.8',
Â  Â  Â  Â  'Referer': 'https://account.apple.com/',
Â  Â  }
Â  Â  params = {
Â  Â  Â  Â  'roleType': 'Agent',
Â  Â  Â  Â  'lv': '0.3.19',
Â  Â  Â  Â  'widgetKey': 'af1139274f266b22b68c2a3e7ad932cb3c0bbe854e13a79af78dcc73136882c3',
Â  Â  Â  Â  'v': '3',
Â  Â  Â  Â  'appContext': 'account',
Â  Â  }
Â  Â  
Â  Â  try:
Â  Â  Â  Â  r_hc = session.get('https://appleid.apple.com/widget/account/', params=params, headers=hc_headers)
Â  Â  Â  Â  challenge = r_hc.headers.get('X-Apple-HC-Challenge')
Â  Â  Â  Â  bits = int(r_hc.headers.get('X-Apple-HC-Bits', '12'))
Â  Â  Â  Â  
Â  Â  Â  Â  if challenge:
Â  Â  Â  Â  Â  Â  HASH_CASH = solve_hashcash(challenge, bits)
Â  Â  Â  Â  Â  Â  print(f"[+] HashCash: {HASH_CASH[:30]}...")
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  print("[!] No HashCash challenge received")
Â  Â  Â  Â  Â  Â  HASH_CASH = None
Â  Â  except Exception as e:
Â  Â  Â  Â  print(f"[!] HashCash error: {e}")
Â  Â  Â  Â  HASH_CASH = None
Â  Â  
Â  Â  time.sleep(random.uniform(1, 2))
Â  Â  
Â  Â  # --- Step 2: Get Captcha ---
Â  Â  print("\n[-] 2. Getting Captcha...")
Â  Â  r_cap = session.post("https://appleid.apple.com/captcha", headers=common_headers, json={"type": "IMAGE"})
Â  Â  
Â  Â  if 'scnt' in r_cap.headers:
Â  Â  Â  Â  common_headers["scnt"] = r_cap.headers['scnt']
Â  Â  Â  Â  print(f"[+] Rotated scnt: {common_headers['scnt'][:20]}...")
Â  Â  
Â  Â  cap_data = r_cap.json()
Â  Â  if 'payload' not in cap_data:
Â  Â  Â  Â  print("[!] Captcha payload missing!")
Â  Â  Â  Â  return False
Â  Â  
Â  Â  captcha_answer = solve_captcha_2captcha(cap_data['payload']['content'])
Â  Â  if not captcha_answer:
Â  Â  Â  Â  print("[!] Failed to solve captcha!")
Â  Â  Â  Â  return False
Â  Â  
Â  Â  time.sleep(random.uniform(1, 2))
Â  Â  
Â  Â  # --- Step 3: Prime Session ---
Â  Â  print(f"\n[-] 3. Priming session for {COUNTRY_ISO3}...")
Â  Â  prime_url = f"https://appleid.apple.com/account?countryCode={COUNTRY_ISO3}"
Â  Â  r_prime = session.get(prime_url, headers=common_headers)
Â  Â  print(f"[+] Prime Response: {r_prime.status_code}")
Â  Â  
Â  Â  if 'scnt' in r_prime.headers:
Â  Â  Â  Â  common_headers["scnt"] = r_prime.headers['scnt']
Â  Â  
Â  Â  time.sleep(random.uniform(1, 2))
Â  Â  
Â  Â  # --- Step 4: Validate Email ---
Â  Â  print("\n[-] 4. Validating Email...")
Â  Â  r_val = session.post("https://appleid.apple.com/account/validation/appleid",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â headers=common_headers, json={"emailAddress": EMAIL})
Â  Â  print(f"[+] Email Validation: {r_val.status_code}")
Â  Â  
Â  Â  if 'scnt' in r_val.headers:
Â  Â  Â  Â  common_headers["scnt"] = r_val.headers['scnt']
Â  Â  
Â  Â  time.sleep(random.uniform(1, 2))
Â  Â  
Â  Â  # --- Step 5: Validate Password ---
Â  Â  print("\n[-] 5. Validating Password...")
Â  Â  r_pwd = session.post("https://appleid.apple.com/account/validate/password",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â headers=common_headers,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â json={"accountName": EMAIL, "password": PASSWORD,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â "firstName": FIRST_NAME, "lastName": LAST_NAME, "updating": False})
Â  Â  print(f"[+] Password Validation: {r_pwd.status_code}")
Â  Â  
Â  Â  if 'scnt' in r_pwd.headers:
Â  Â  Â  Â  common_headers["scnt"] = r_pwd.headers['scnt']
Â  Â  
Â  Â  time.sleep(random.uniform(1, 2))
Â  Â  
Â  Â  # --- Step 6: Full Account Validation ---
Â  Â  print("\n[-] 6. Full Account Validation...")
Â  Â  
Â  Â  full_data = {
Â  Â  Â  Â  "account": {
Â  Â  Â  Â  Â  Â  "name": EMAIL,
Â  Â  Â  Â  Â  Â  "password": PASSWORD,
Â  Â  Â  Â  Â  Â  "person": {
Â  Â  Â  Â  Â  Â  Â  Â  "birthday": BIRTHDAY,
Â  Â  Â  Â  Â  Â  Â  Â  "name": {"firstName": FIRST_NAME.upper(), "lastName": LAST_NAME.upper()},
Â  Â  Â  Â  Â  Â  Â  Â  "primaryAddress": {"country": COUNTRY_ISO3}
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  "preferences": {
Â  Â  Â  Â  Â  Â  Â  Â  "marketingPreferences": {"appleNews": False, "appleUpdates": True, "iTunesUpdates": True},
Â  Â  Â  Â  Â  Â  Â  Â  "preferredLanguage": "ar_SA"
Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  "verificationInfo": {"answer": "", "id": ""}
Â  Â  Â  Â  },
Â  Â  Â  Â  "captcha": {
Â  Â  Â  Â  Â  Â  "answer": captcha_answer,
Â  Â  Â  Â  Â  Â  "id": cap_data.get('id'),
Â  Â  Â  Â  Â  Â  "token": cap_data.get('token')
Â  Â  Â  Â  },
Â  Â  Â  Â  "phoneNumberVerification": {
Â  Â  Â  Â  Â  Â  "mode": "sms",
Â  Â  Â  Â  Â  Â  "phoneNumber": {
Â  Â  Â  Â  Â  Â  Â  Â  "countryCode": COUNTRY_CODE,
Â  Â  Â  Â  Â  Â  Â  Â  "countryDialCode": COUNTRY_DIAL_CODE,
Â  Â  Â  Â  Â  Â  Â  Â  "id": 1,
Â  Â  Â  Â  Â  Â  Â  Â  "nonFTEU": True,
Â  Â  Â  Â  Â  Â  Â  Â  "number": PHONE_NUMBER
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  Â  "privacyPolicyChecked": True
Â  Â  }
Â  Â  
Â  Â  # Ø¥Ø¶Ø§ÙØ© HashCash Ù„Ù„Ù€ validation
Â  Â  validation_headers = common_headers.copy()
Â  Â  if HASH_CASH:
Â  Â  Â  Â  validation_headers["X-APPLE-HC"] = HASH_CASH
Â  Â  
Â  Â  r_full = session.post("https://appleid.apple.com/account/validate",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  headers=validation_headers, json=full_data)
Â  Â  print(f"[+] Full Validation Status: {r_full.status_code}")
Â  Â  
Â  Â  if r_full.status_code == 200:
Â  Â  Â  Â  print("\n" + "="*50)
Â  Â  Â  Â  print("âœ… SUCCESS! Account Validated!")
Â  Â  Â  Â  print("="*50)
Â  Â  Â  Â  
Â  Â  Â  Â  if 'scnt' in r_full.headers:
Â  Â  Â  Â  Â  Â  common_headers["scnt"] = r_full.headers['scnt']
Â  Â  Â  Â  
Â  Â  Â  Â  # --- Step 7: Request SMS ---
Â  Â  Â  Â  print("\n[-] 7. Requesting SMS...")
Â  Â  Â  Â  phone_req_data = {
Â  Â  Â  Â  Â  Â  "account": {"name": EMAIL, "person": {"name": {"firstName": FIRST_NAME.upper(), "lastName": LAST_NAME.upper()}}},
Â  Â  Â  Â  Â  Â  "countryCode": COUNTRY_CODE,
Â  Â  Â  Â  Â  Â  "phoneNumber": {"id": 1, "number": PHONE_NUMBER, "countryCode": COUNTRY_CODE, "countryDialCode": COUNTRY_DIAL_CODE},
Â  Â  Â  Â  Â  Â  "mode": "sms"
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  r_sms = session.post("https://appleid.apple.com/account/verification",
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â headers=common_headers, json=phone_req_data)
Â  Â  Â  Â  print(f"[+] SMS Request Status: {r_sms.status_code}")
Â  Â  Â  Â  
Â  Â  Â  Â  if r_sms.status_code == 200:
Â  Â  Â  Â  Â  Â  print("\nğŸ“± SMS Sent! Check your phone.")
Â  Â  Â  Â  Â  Â  print(f"\nğŸ“§ Email: {EMAIL}")
Â  Â  Â  Â  Â  Â  print(f"ğŸ” Password: {PASSWORD}")
Â  Â  Â  Â  Â  Â  return True
Â  Â  Â  Â  else:
Â  Â  Â  Â  Â  Â  print(f"[!] SMS Failed: {r_sms.text[:200]}")
Â  Â  else:
Â  Â  Â  Â  print(f"\n[!] Validation Failed!")
Â  Â  Â  Â  print(f"[!] Error: {r_full.text}")
Â  Â  
Â  Â  return False

# ========================================
# MAIN
# ========================================
def main():
Â  Â  print("\n" + "="*60)
Â  Â  print("ğŸ Apple Hybrid Account Creator V1")
Â  Â  print(" Â  Â Browser â†’ Fingerprint â†’ Requests â†’ Account")
Â  Â  print("="*60)
Â  Â  
Â  Â  # Phase 1: Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¨ØµÙ…Ø© Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­
Â  Â  session_data = extract_session_from_browser()
Â  Â  
Â  Â  if not session_data.get('fingerprint'):
Â  Â  Â  Â  print("\n[!] Failed to extract session data from browser!")
Â  Â  Â  Â  return
Â  Â  
Â  Â  # Phase 2: Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù€ requests
Â  Â  success = complete_registration_with_requests(session_data)
Â  Â  
Â  Â  if success:
Â  Â  Â  Â  print("\n" + "="*60)
Â  Â  Â  Â  print("ğŸ‰ ACCOUNT CREATED SUCCESSFULLY!")
Â  Â  Â  Â  print("="*60)
Â  Â  else:
Â  Â  Â  Â  print("\n" + "="*60)
Â  Â  Â  Â  print("âŒ Account creation failed")
Â  Â  Â  Â  print("="*60)

if __name__ == "__main__":
Â  Â  main()


Ø¹Ø§ÙˆØ²Ùƒ ØªØ¹Ù…Ù„ÙŠ Ø¨Ø±ÙˆÙ…Øª Ø¨Ø³ Ù‚Ø¨Ù„ Ø¨Ø±ÙˆÙ…Øª Ø§ØªØ§ÙƒØ¯ Ù…Ù†ÙŠ Ø§Ù„Ø§ÙˆÙ„ Ù†ØªÙÙ‚ Ù…Ø¹ Ø¨Ø¹Ø¶
Ø¨Øµ Ø¹Ø§ÙˆØ² Ø³ÙƒØ±Ø¨Øª Ù…Ù†ÙØµÙ„ÙŠÙ† ØªÙ…Ø§Ù…Ø§ Ø§ÙˆÙ„ Ø¨ØªØ§Ø¹ Ù…ØªØµÙØ­ ÙŠØ·Ù„Ø¹ Ù…Ù„Ù Ø¬ÙŠØ³ÙˆÙ† Ø®Ø§Ø±Ø¬ÙŠ Ùˆ Ø¨ØªØ§Ø¹ Ø±ÙŠÙƒÙˆÙŠØ³Øª ÙŠØ§Ø®Ø¯ Ù…Ù†Ù‡
Ø¨Ø³ ÙƒÙ„ Ø³ÙƒØ±Ø¨Øª Ù…Ù†ÙØµÙ„ 
Ù…Ø´ Ø¹Ø§ÙˆØ² Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¨ÙŠÙ†Ù‡Ù…
ÙˆÙƒÙ…Ø§Ù† Ø¹Ø§ÙˆØ² Ø³ÙƒØ±Ø¨ØªÙŠÙ† ÙŠÙƒÙˆÙ†Ùˆ Ù†ÙØ³ Ù…Ù„ÙØ§Øª "ZXZ.PY"
